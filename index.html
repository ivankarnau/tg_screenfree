<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ScreenFree Mini-App</title>

  <!-- Telegram Web-App API -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    window.isIOS      = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    window.isTelegram = navigator.userAgent.includes('Telegram');
  </script>


<script>
  // Проверка поддержки Web Audio API
  window.AudioContext = window.AudioContext || window.webkitAudioContext;
  
  // Инициализация Quiet для iOS
  if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
    document.addEventListener('touchstart', function initQuiet() {
      if (!window.Quiet) return;
      
      Quiet.init({
        profilesPrefix: '/quiet/',
        memoryInitializerPrefix: '/quiet/'
      });
      
      Quiet.addReadyCallback(
        function() {
          window.postMessage('quiet-ready', '*');
        },
        function(e) {
          window.postMessage('quiet-failed:' + e, '*');
        }
      );
      
      document.removeEventListener('touchstart', initQuiet);
    }, { once: true });
  }
</script>

  <!-- Quiet bindings -->
  <script src="/quiet/quiet.js"></script>
  <script>
    Quiet.init({
      profilesPrefix:          '/quiet/',
      memoryInitializerPrefix: '/quiet/'
    });

    Quiet.addReadyCallback(
      () => {
        window.postMessage('quiet-ready','*');
      },
      (e) => {
        window.postMessage('quiet-failed:' + e, '*');
      }
    );
  </script>
  <script async src="/quiet/quiet-emscripten.js"></script>
  <script>
    if (window.isIOS) {
      const iosBootstrap = () => {
        const frame = document.createElement('iframe');
        frame.style.display = 'none';
        frame.srcdoc = `
          <script src="/quiet/quiet.js"><\/script>
          <script>
            Quiet.init({
              profilesPrefix: '/quiet/',
              memoryInitializerPrefix: '/quiet/'
            });
            Quiet.addReadyCallback(
              () => parent.postMessage('quiet-ready','*'),
              (e)=> parent.postMessage('quiet-failed:'+e,'*')
            );
          <\/script>
          <script async src="/quiet/quiet-emscripten.js"><\/script>
        `;
        document.body.appendChild(frame);
      };
      window.addEventListener('touchstart', iosBootstrap, { once:true });
      window.addEventListener('click',      iosBootstrap, { once:true });
    }
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>
</html>
